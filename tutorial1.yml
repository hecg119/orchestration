version: '3'
services:
  ambassador:
    image: "polyswarm/ambassador"
    depends_on:
      - polyswarmd
    environment:
      - POLYSWARMD_HOST=polyswarmd
      - POLYSWARMD_PORT=31337
    command: "./wait_and_run.sh"
  arbiter:
    image: "polyswarm/arbiter"
    depends_on:
      - polyswarmd
      - homechain
    environment:
      - PYTHONUNBUFFERED=1
      - POLYSWARM_HOST=http://polyswarmd:31337
      - GETH=http://homechain:8545
      - ADDRESS=0xf870491ea0f53f67846eecb57855284d8270284d
      - PASSWORD=password
      - CHAIN=home
    command: "./scripts/wait_for_it.sh -t 0 polyswarmd:31337 -- python arbiter.py --backend verbatim --test"
  tutorial:
        image: "polyswarm/microengine"
        depends_on:
            - polyswarmd
        environment:
           - POLYSWARMD_HOST=polyswarmd
           - POLYSWARMD_PORT=31337
           - POLYSWARMD_ADDR=polyswarmd:31337
           - CLAMD_HOST=clamav
           - CLAMD_PORT=3310
        command: "./scripts/wait_and_clam.sh"
  clamav:
        image: "mkodockx/docker-clamav"
        ports:
           - 3310:3310